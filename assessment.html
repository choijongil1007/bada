<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Deal Assessment - BADA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-body: #f5f5f7;
      --bg-surface: #ffffff;
      --bg-subtle: #f9fafb;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --text-main: #111827;
      --text-muted: #6b7280;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --accent-strong: #1d4ed8;
      --success: #10b981;
      --success-soft: #d1fae5;
      --danger: #ef4444;
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 10px;
      --shadow-soft: 0 14px 40px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e5f0ff, #f5f5f7 45%);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(245, 245, 247, 0.9), rgba(245, 245, 247, 0.7));
      border-bottom: 1px solid rgba(229, 231, 235, 0.8);
    }

    .header-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 20%, #93c5fd, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 12px 35px rgba(37, 99, 235, 0.45);
    }

    .brand-text-main {
      font-weight: 650;
      letter-spacing: 0.02em;
      font-size: 17px;
    }

    .brand-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-main);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.12s ease;
      text-decoration: none;
    }

    .btn-back:hover {
      background: #ffffff;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }

    /* Main Layout */
    main {
      flex: 1;
    }

    .content-wrapper {
      max-width: 1120px;
      margin: 24px auto;
      padding: 0 20px 32px 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      align-items: flex-start;
    }

    /* Sidebar - Deal Info */
    .sidebar-panel {
      position: sticky;
      top: 90px;
      background: rgba(255, 255, 255, 0.92);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(229, 231, 235, 0.9);
      box-shadow: var(--shadow-soft);
      padding: 18px;
    }

    .sidebar-header {
      margin-bottom: 12px;
    }

    .sidebar-title {
      font-size: 15px;
      font-weight: 600;
      margin: 0 0 4px 0;
    }

    .sidebar-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .deal-info-item {
      padding: 8px 0;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 12px;
    }

    .deal-info-item:last-child {
      border-bottom: none;
    }

    .deal-info-label {
      color: var(--text-muted);
      font-weight: 500;
      margin-bottom: 3px;
    }

    .deal-info-value {
      color: var(--text-main);
    }

    .progress-indicator {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-subtle);
    }

    .progress-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-subtle);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #34d399, #10b981);
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    /* Main Content */
    .main-panel {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(229, 231, 235, 0.9);
      box-shadow: var(--shadow-soft);
      padding: 20px;
    }

    .main-header {
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .main-title {
      font-size: 20px;
      font-weight: 650;
      margin: 0 0 6px 0;
    }

    .main-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Section Cards */
    .section {
      margin-bottom: 20px;
    }

    .section-card {
      background: var(--bg-subtle);
      border-radius: var(--radius-md);
      padding: 16px 18px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .pill-muted {
      font-size: 11px;
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(15, 23, 42, 0.04);
      color: var(--text-muted);
    }

    .section-body {
      margin-top: 8px;
    }

    /* Tables */
    .grid-two {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    .score-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .score-table thead {
      background: #e5e7eb;
    }

    .score-table th,
    .score-table td {
      padding: 8px 10px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      vertical-align: middle;
    }

    .score-table th:first-child,
    .score-table td:first-child {
      border-left: 1px solid #e5e7eb;
    }

    .score-table th:last-child,
    .score-table td:last-child {
      border-right: 1px solid #e5e7eb;
    }

    .score-table th {
      font-weight: 500;
      color: #374151;
    }

    .score-table tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .score-table caption {
      text-align: left;
      font-size: 11px;
      margin-bottom: 8px;
      color: var(--text-muted);
    }

    .group-row {
      background: #f3f4f6 !important;
      font-weight: 600;
      font-size: 11px;
      color: #111827;
    }

    /* Form Elements */
    .form-field {
      margin-bottom: 8px;
    }

    .form-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
      color: #374151;
    }

    .required-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--danger);
    }

    select {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-subtle);
      padding: 6px 8px;
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.12);
    }

    /* Info Icons & Tooltips */
    .info-icon {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #6b7280;
      cursor: pointer;
      background: #ffffff;
      position: relative;
    }

    .tooltip {
      position: absolute;
      z-index: 30;
      top: 125%;
      left: 50%;
      transform: translateX(-50%);
      min-width: 220px;
      max-width: 260px;
      background: #111827;
      color: #f9fafb;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 11px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.5);
      display: none;
      text-align: left;
    }

    .tooltip.visible {
      display: block;
    }

    .tooltip-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .tooltip-line {
      margin-bottom: 2px;
      color: #e5e7eb;
      text-align: left;
    }

    .tooltip-line span {
      font-weight: 500;
    }

    /* Weights */
    .weight-card {
      background: #f9fafb;
      border-radius: var(--radius-sm);
      padding: 12px;
      border: 1px dashed var(--border-subtle);
      font-size: 12px;
    }

    .weight-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .weight-card-title {
      font-weight: 500;
      font-size: 12px;
    }

    .weight-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .weight-row span {
      font-size: 12px;
      color: #374151;
    }

    .weight-controls {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .weight-btn {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .weight-btn:hover {
      background: #f3f4f6;
    }

    .weight-input {
      width: 64px;
      text-align: right;
      font-variant-numeric: tabular-nums;
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 2px 6px;
      font-size: 12px;
    }

    .weight-sum {
      font-size: 11px;
      color: var(--text-muted);
      text-align: right;
      margin-top: 4px;
    }

    .weight-sum.error {
      color: var(--danger);
    }

    .helper-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Buttons */
    .btn-primary,
    .btn-secondary {
      border-radius: 999px;
      font-size: 13px;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #34d399, #10b981);
      color: white;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #10b981, #059669);
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(5, 150, 105, 0.4);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
      font-weight: 500;
    }

    .btn-secondary:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    .section-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Results & Summaries */
    .result-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .result-pill {
      background: #111827;
      color: #f9fafb;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .result-label {
      font-size: 11px;
      color: #d1d5db;
    }

    .risk-card {
      margin-top: 12px;
      background: #111827;
      color: #f9fafb;
      border-radius: var(--radius-md);
      padding: 12px 16px;
      font-size: 12px;
    }

    .risk-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    .risk-card-title {
      font-weight: 500;
      font-size: 12px;
    }

    .risk-chip {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 8px;
      background: rgba(248, 250, 252, 0.08);
      color: #e5e7eb;
    }

    .risk-list {
      margin: 0;
      padding-left: 16px;
    }

    .risk-list li {
      margin-bottom: 4px;
      line-height: 1.4;
    }

    /* Summary Bar */
    .summary-bar {
      padding: 8px 12px;
      border-radius: 999px;
      background: #eef2ff;
      color: #111827;
      font-size: 12px;
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .summary-bar span.label {
      font-weight: 500;
    }

    .summary-toggle-btn {
      border-radius: 999px;
      border: none;
      background: transparent;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #4b5563;
      cursor: pointer;
      padding: 4px 8px;
    }

    .summary-toggle-btn:hover {
      background: rgba(15, 23, 42, 0.06);
    }

    .summary-bar small {
      color: #4b5563;
      font-size: 11px;
    }

    /* Dashboard */
    .dashboard-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .metric-card {
      background: #f9fafb;
      border-radius: var(--radius-sm);
      padding: 12px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
    }

    .metric-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .metric-sub {
      font-size: 11px;
      color: #4b5563;
      margin-top: 2px;
    }

    .quadrant-card {
      background: #f9fafb;
      border-radius: var(--radius-md);
      padding: 12px;
      border: 1px solid var(--border-subtle);
    }

    .quadrant-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
      font-size: 12px;
    }

    canvas#quadrantCanvas {
      width: 100%;
      max-width: 420px;
      height: 260px;
      border-radius: var(--radius-sm);
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      display: block;
    }

    .summary-card {
      background: #111827;
      color: #f9fafb;
      border-radius: var(--radius-md);
      padding: 16px;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 120px;
    }

    .summary-zone {
      font-weight: 600;
      font-size: 13px;
    }

    .summary-body {
      color: #e5e7eb;
      line-height: 1.5;
    }

    .summary-actions {
      font-size: 11px;
      color: #cbd5f5;
      line-height: 1.4;
    }

    /* Save Banner */
    .save-banner {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #34d399, #10b981);
      color: white;
      padding: 12px 20px;
      border-radius: 999px;
      box-shadow: 0 14px 40px rgba(16, 185, 129, 0.5);
      font-size: 13px;
      font-weight: 600;
      display: none;
      align-items: center;
      gap: 8px;
      animation: slideUp 0.3s ease;
    }

    .save-banner.show {
      display: flex;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 960px) {
      .content-wrapper {
        grid-template-columns: 1fr;
      }

      .sidebar-panel {
        position: relative;
        top: 0;
      }
    }

    @media (max-width: 768px) {
      .grid-two {
        grid-template-columns: 1fr;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      canvas#quadrantCanvas {
        height: 220px;
      }
    }

    @media (max-width: 520px) {
      .header-inner {
        padding-inline: 14px;
      }

      .content-wrapper {
        padding-inline: 14px;
      }

      .brand-text-sub {
        display: none;
      }

      .section-footer {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="header-inner">
        <div class="brand">
          <div class="brand-logo">B</div>
          <div>
            <div class="brand-text-main">BADA</div>
            <div class="brand-text-sub">Deal Assessment · Qualification</div>
          </div>
        </div>
        <div class="header-actions">
          <a href="index.html" class="btn-back">
            <span>←</span>
            <span>Deal 목록</span>
          </a>
        </div>
      </div>
    </header>

    <main>
      <div class="content-wrapper">
        <!-- Sidebar: Deal Info -->
        <aside class="sidebar-panel">
          <div class="sidebar-header">
            <h3 class="sidebar-title">Deal 정보</h3>
            <p class="sidebar-subtitle">현재 평가 중인 Deal</p>
          </div>
          <div id="deal-info"></div>
          <div class="progress-indicator">
            <div class="progress-label">Assessment 진행률</div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
          </div>
        </aside>

        <!-- Main: Assessment Sections -->
        <section class="main-panel">
          <div class="main-header">
            <h1 class="main-title">Deal Assessment</h1>
            <p class="main-subtitle">
              Business Fit과 Technical Fit을 종합적으로 평가하여 Deal의 수주 가능성과 리스크를 분석합니다.
              각 항목에 점수를 부여하고 가중치를 설정하면 자동으로 종합 점수가 계산됩니다.
            </p>
          </div>

          <!-- Deal Win Score Section -->
          <div class="section">
            <div class="section-card" id="dealWinSection">
              <div class="section-header">
                <div>
                  <div class="section-title">
                    <span>Deal Win Score</span>
                    <span class="pill-muted">Business Fit</span>
                  </div>
                  <div class="section-subtitle">
                    Budget / Authority / Need / Timeline 관점에서 수주 가능성을 정량화합니다.
                  </div>
                </div>
              </div>
              <table class="score-table">
                <caption>
                  각 항목에 1~5 점을 부여하세요. (5점이 가장 우수)
                </caption>
                <thead>
                  <tr>
                    <th style="width:25%;">Deal 항목</th>
                    <th style="width:40%;">세부 항목</th>
                    <th style="width:20%;">점수</th>
                    <th style="width:15%;">i</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="group-row">
                    <td>Budget</td>
                    <td colspan="3">예산 및 구매 준비도</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>예산 및 구매 준비도</td>
                    <td>
                      <select data-dw-score="budgetReadiness">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-budget-readiness">i
                        <div class="tooltip" id="tt-budget-readiness">
                          <div class="tooltip-title">Budget · 예산 및 구매 준비도</div>
                          <div class="tooltip-line"><span>5점</span> · 예산 확정 / 승인권자 동의 / 구매 절차 명확</div>
                          <div class="tooltip-line"><span>4점</span> · 예산 거의 확정, 내부 승인 절차만 남은 상태</div>
                          <div class="tooltip-line"><span>3점</span> · 예산 가능하나 승인 필요 / 가격 민감 / 불확실</div>
                          <div class="tooltip-line"><span>2점</span> · 예산 후보 수준 / 우선순위 낮음 / 축소 가능성 있음</div>
                          <div class="tooltip-line"><span>1점</span> · 예산 없음 / 승인 의사 없음</div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr class="group-row">
                    <td>Authority</td>
                    <td colspan="3">내부 지지자 파워 &amp; 의사결정권자 접근성</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>내부 지지자 파워</td>
                    <td>
                      <select data-dw-score="authorityChampion">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-authority-champion">i
                        <div class="tooltip" id="tt-authority-champion">
                          <div class="tooltip-title">Authority · 내부 지지자 파워</div>
                          <div class="tooltip-line"><span>5점</span> · 파워 챔피언 / 적극적 지지 / 내부 추진 강함</div>
                          <div class="tooltip-line"><span>4점</span> · 중간 관리자급 챔피언 / 영향력 높음</div>
                          <div class="tooltip-line"><span>3점</span> · 실무 리더급 챔피언 / 내부 논의 주도 가능</div>
                          <div class="tooltip-line"><span>2점</span> · 챔피언 후보 있으나 영향력 약함</div>
                          <div class="tooltip-line"><span>1점</span> · 챔피언 없음 / 단순 관심자</div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>의사결정권자 접근성</td>
                    <td>
                      <select data-dw-score="authorityAccess">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-authority-access">i
                        <div class="tooltip" id="tt-authority-access">
                          <div class="tooltip-title">Authority · 의사결정권자 접근성</div>
                          <div class="tooltip-line"><span>5점</span> · EB와 직접 대화 / 니즈·우선순위 확인됨</div>
                          <div class="tooltip-line"><span>4점</span> · 영향력 있는 관리자 접촉 / EB 경로 확보</div>
                          <div class="tooltip-line"><span>3점</span> · 의사결정 구조 파악 / EB 접촉 가능성 존재</div>
                          <div class="tooltip-line"><span>2점</span> · EB는 알지만 접촉 불가 / 간접 정보만 있음</div>
                          <div class="tooltip-line"><span>1점</span> · EB가 누구인지 모름 / 접근 불가</div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr class="group-row">
                    <td>Need</td>
                    <td colspan="3">문제 적합성 &amp; 경쟁 구도</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>문제 적합성</td>
                    <td>
                      <select data-dw-score="needFit">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-need-fit">i
                        <div class="tooltip" id="tt-need-fit">
                          <div class="tooltip-title">Need · 문제 적합성</div>
                          <div class="tooltip-line"><span>5점</span> · 핵심 Pain / 우리 솔루션이 가장 적합</div>
                          <div class="tooltip-line"><span>4점</span> · 주요 Pain에 적합 / 일부 보완 필요</div>
                          <div class="tooltip-line"><span>3점</span> · 문제 명확 / 솔루션으로 해결 가능</div>
                          <div class="tooltip-line"><span>2점</span> · 문제는 있으나 Fit 낮음 / 고객도 확신 없음</div>
                          <div class="tooltip-line"><span>1점</span> · 문제 모호 / 솔루션과 연결 약함</div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>경쟁 구도</td>
                    <td>
                      <select data-dw-score="needCompetition">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-need-competition">i
                        <div class="tooltip" id="tt-need-competition">
                          <div class="tooltip-title">Need · 경쟁 구도</div>
                          <div class="tooltip-line"><span>5점</span> · 사실상 우리 선택 / PoC 시 확정 수준</div>
                          <div class="tooltip-line"><span>4점</span> · 여러 면에서 우리가 우위</div>
                          <div class="tooltip-line"><span>3점</span> · 비슷비슷 / 비교 초기</div>
                          <div class="tooltip-line"><span>2점</span> · 경쟁 우세 / 우리 쪽 약함</div>
                          <div class="tooltip-line"><span>1점</span> · 경쟁사 우위 / 고객 선호도 낮음</div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr class="group-row">
                    <td>Timeline</td>
                    <td colspan="3">시급성/타이밍 &amp; 도입 용이성</td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>시급성/타이밍</td>
                    <td>
                      <select data-dw-score="timelineUrgency">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-timeline-urgency">i
                        <div class="tooltip" id="tt-timeline-urgency">
                          <div class="tooltip-title">Timeline · 시급성/타이밍</div>
                          <div class="tooltip-line"><span>5점</span> · 즉시 필요 / 계약·규제 등 긴급 사유</div>
                          <div class="tooltip-line"><span>4점</span> · 프로젝트 일정과 연결 / 조만간 결정 필요</div>
                          <div class="tooltip-line"><span>3점</span> · 분기 내 검토 필요 / 일정 일부 존재</div>
                          <div class="tooltip-line"><span>2점</span> · 관심은 있으나 일정 불확실</div>
                          <div class="tooltip-line"><span>1점</span> · 급하지 않음 / 계획 없음</div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td>도입 용이성</td>
                    <td>
                      <select data-dw-score="timelineEase">
                        <option value="">-</option>
                        <option value="5">5</option>
                        <option value="4">4</option>
                        <option value="3">3</option>
                        <option value="2">2</option>
                        <option value="1">1</option>
                      </select>
                    </td>
                    <td>
                      <div class="info-icon" data-tooltip-id="tt-timeline-ease">i
                        <div class="tooltip" id="tt-timeline-ease">
                          <div class="tooltip-title">Timeline · 도입 용이성</div>
                          <div class="tooltip-line"><span>5점</span> · 즉시 사용 가능 / 리스크 거의 없음</div>
                          <div class="tooltip-line"><span>4점</span> · 도입 쉬움 / 통합 간단</div>
                          <div class="tooltip-line"><span>3점</span> · 일반적 난이도 / 보통 수준</div>
                          <div class="tooltip-line"><span>2점</span> · 장벽 있지만 가능 / 리스크 존재</div>
                          <div class="tooltip-line"><span>1점</span> · 기술적 장애 큼 / 통합 어려움</div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="section-footer">
                <div class="helper-text">
                  모든 항목의 점수를 설정한 뒤, 결과 보기를 눌러 Deal Score와 Win Probability를 확인하세요.
                </div>
                <div>
                  <button class="btn-primary" id="dealWinResultButton">
                    결과 보기
                  </button>
                </div>
              </div>

              <div id="dealWinResultArea" style="display:none;">
                <div class="result-summary">
                  <div class="result-pill">
                    <div>
                      <div class="result-label">Deal Score</div>
                      <div id="dealScoreValue">-</div>
                    </div>
                    <div>
                      <div class="result-label">Win Probability</div>
                      <div id="winProbValue">-</div>
                    </div>
                  </div>
                </div>
                <div class="risk-card">
                  <div class="risk-card-header">
                    <div class="risk-card-title">Risk Summary</div>
                    <span class="risk-chip">합산 점수 2 이하 항목</span>
                  </div>
                  <ul class="risk-list" id="dealWinRiskList"></ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Technical Fit Score Section -->
          <div class="section">
            <div class="section-card" id="techFitSection">
              <div class="section-header">
                <div>
                  <div class="section-title">
                    <span>Technical Fit Score</span>
                    <span class="pill-muted">Technical Risk</span>
                  </div>
                  <div class="section-subtitle">
                    기능, 인프라, 규제/보안, 실행 가능성 관점에서 기술적 리스크를 평가합니다.
                  </div>
                </div>
              </div>
              <div class="section-body" id="techFitSectionBody">
                <div class="grid-two">
                  <div>
                    <table class="score-table">
                      <caption>
                        각 적합성 항목에 1~5 점을 부여하세요. (5점이 가장 적합)
                      </caption>
                      <thead>
                        <tr>
                          <th style="width:25%;">적합성 항목</th>
                          <th style="width:40%;">세부 항목</th>
                          <th style="width:20%;">점수</th>
                          <th style="width:15%;">i</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="group-row">
                          <td>Technical Fit</td>
                          <td colspan="3">기능 적합성 / 커스터마이징 / 레거시</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>기능 적합성</td>
                          <td>
                            <select data-tf-score="tfFunctional">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-tf-functional">i
                              <div class="tooltip" id="tt-tf-functional">
                                <div class="tooltip-title">Technical Fit · 기능 적합성</div>
                                <div class="tooltip-line"><span>5점</span> · 요구사항 완전 일치 / 최적 Fit</div>
                                <div class="tooltip-line"><span>4점</span> · 필수 기능 충족 / 옵션만 조정 필요</div>
                                <div class="tooltip-line"><span>3점</span> · 주요 기능 대부분 충족 / 보통 수준</div>
                                <div class="tooltip-line"><span>2점</span> · 핵심 기능 일부 부족 / 커스터마이징 필수</div>
                                <div class="tooltip-line"><span>1점</span> · 요구 기능 대부분 불일치 / 구현 어려움</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>커스터마이징 필요도</td>
                          <td>
                            <select data-tf-score="tfCustomization">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-tf-customization">i
                              <div class="tooltip" id="tt-tf-customization">
                                <div class="tooltip-title">Technical Fit · 커스터마이징 필요도</div>
                                <div class="tooltip-line"><span>5점</span> · 구성만으로 즉시 적용 가능</div>
                                <div class="tooltip-line"><span>4점</span> · 소규모 구성 정도 / 부담 낮음</div>
                                <div class="tooltip-line"><span>3점</span> · 일반적 난이도 / 구현 가능</div>
                                <div class="tooltip-line"><span>2점</span> · 개발 필요하나 가능 / 리스크 존재</div>
                                <div class="tooltip-line"><span>1점</span> · 커스터마이징 많음 / 높은 복잡도</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>레거시 제약</td>
                          <td>
                            <select data-tf-score="tfLegacy">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-tf-legacy">i
                              <div class="tooltip" id="tt-tf-legacy">
                                <div class="tooltip-title">Technical Fit · 레거시 제약</div>
                                <div class="tooltip-line"><span>5점</span> · 제약 거의 없음 / 최적 환경</div>
                                <div class="tooltip-line"><span>4점</span> · 제약 적음 / 대부분 호환</div>
                                <div class="tooltip-line"><span>3점</span> · 일부 제약 있으나 현실적 대안 존재</div>
                                <div class="tooltip-line"><span>2점</span> · 제약 존재 / 우회 가능하나 위험</div>
                                <div class="tooltip-line"><span>1점</span> · 레거시 제약 심각 / 연동 불가</div>
                              </div>
                            </div>
                          </td>
                        </tr>

                        <tr class="group-row">
                          <td>Environment &amp; Integration</td>
                          <td colspan="3">인프라 / 연동 / 네트워크 제약</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>인프라 호환성</td>
                          <td>
                            <select data-tf-score="envInfra">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-env-infra">i
                              <div class="tooltip" id="tt-env-infra">
                                <div class="tooltip-title">Environment · 인프라 호환성</div>
                                <div class="tooltip-line"><span>5점</span> · 완전 호환 / 즉시 사용 가능</div>
                                <div class="tooltip-line"><span>4점</span> · 전반적 호환 양호</div>
                                <div class="tooltip-line"><span>3점</span> · 보통 수준 호환 / 일부 검증 필요</div>
                                <div class="tooltip-line"><span>2점</span> · 호환성 낮음 / 조정 필요</div>
                                <div class="tooltip-line"><span>1점</span> · 호환 거의 불가 / 제약 매우 큼</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>연동 지원 여부</td>
                          <td>
                            <select data-tf-score="envIntegration">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-env-integration">i
                              <div class="tooltip" id="tt-env-integration">
                                <div class="tooltip-title">Environment · 연동 지원 여부</div>
                                <div class="tooltip-line"><span>5점</span> · 즉시 연동 가능 / 장애 요소 없음</div>
                                <div class="tooltip-line"><span>4점</span> · 연동 수월함 / 기존 레퍼런스 존재</div>
                                <div class="tooltip-line"><span>3점</span> · 일반적 난이도 / 표준 프로토콜 기반</div>
                                <div class="tooltip-line"><span>2점</span> · 연동 가능하나 난이도 높음</div>
                                <div class="tooltip-line"><span>1점</span> · 연동 불가 혹은 매우 어려움</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>환경/네트워크 제약</td>
                          <td>
                            <select data-tf-score="envNetwork">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-env-network">i
                              <div class="tooltip" id="tt-env-network">
                                <div class="tooltip-title">Environment · 환경 / 네트워크 제약</div>
                                <div class="tooltip-line"><span>5점</span> · 제약 거의 없음 / 최적 환경</div>
                                <div class="tooltip-line"><span>4점</span> · 대부분 문제 없음</div>
                                <div class="tooltip-line"><span>3점</span> · 일부 제약 있으나 관리 가능</div>
                                <div class="tooltip-line"><span>2점</span> · 제약 존재 / 설정 조정 필요</div>
                                <div class="tooltip-line"><span>1점</span> · 환경·네트워크 제약 매우 심각</div>
                              </div>
                            </div>
                          </td>
                        </tr>

                        <tr class="group-row">
                          <td>Compliance &amp; Security</td>
                          <td colspan="3">보안 / 규제 / 데이터·보안 적합성</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>보안 검토 난이도</td>
                          <td>
                            <select data-tf-score="compSecurity">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-comp-security">i
                              <div class="tooltip" id="tt-comp-security">
                                <div class="tooltip-title">Compliance · 보안 검토 난이도</div>
                                <div class="tooltip-line"><span>5점</span> · 문제 없음 / 승인 확실</div>
                                <div class="tooltip-line"><span>4점</span> · 대부분 충족 / 승인 가능성 높음</div>
                                <div class="tooltip-line"><span>3점</span> · 보통 난이도 / 일부 검토 필요</div>
                                <div class="tooltip-line"><span>2점</span> · 충족 가능하나 불확실성 큼</div>
                                <div class="tooltip-line"><span>1점</span> · 보안 충족 어려움 / 리스크 큼</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>규제 준수 가능성</td>
                          <td>
                            <select data-tf-score="compRegulatory">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-comp-reg">i
                              <div class="tooltip" id="tt-comp-reg">
                                <div class="tooltip-title">Compliance · 규제 준수 가능성</div>
                                <div class="tooltip-line"><span>5점</span> · 완전 충족 / 검증 문제 없음</div>
                                <div class="tooltip-line"><span>4점</span> · 규제 충족 가능성이 높음</div>
                                <div class="tooltip-line"><span>3점</span> · 대부분 충족 / 추가 조정 필요</div>
                                <div class="tooltip-line"><span>2점</span> · 충족 가능하나 장애물 많음</div>
                                <div class="tooltip-line"><span>1점</span> · 규제 충족 불가</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>데이터/보안 적합성</td>
                          <td>
                            <select data-tf-score="compData">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-comp-data">i
                              <div class="tooltip" id="tt-comp-data">
                                <div class="tooltip-title">Compliance · 데이터/보안 적합성</div>
                                <div class="tooltip-line"><span>5점</span> · 완전 적합 / 요구 충족</div>
                                <div class="tooltip-line"><span>4점</span> · 전반적 적합 / 리스크 낮음</div>
                                <div class="tooltip-line"><span>3점</span> · 대부분 충족 / 조정 가능</div>
                                <div class="tooltip-line"><span>2점</span> · 일부 불일치 / 수정 필요</div>
                                <div class="tooltip-line"><span>1점</span> · 요구 기준과 불일치</div>
                              </div>
                            </div>
                          </td>
                        </tr>

                        <tr class="group-row">
                          <td>Human &amp; Execution Readiness</td>
                          <td colspan="3">고객 기술팀 / 지원 리소스 / 일정 현실성</td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>고객 기술팀 준비도</td>
                          <td>
                            <select data-tf-score="humanTeam">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-human-team">i
                              <div class="tooltip" id="tt-human-team">
                                <div class="tooltip-title">Human · 고객 기술팀 준비도</div>
                                <div class="tooltip-line"><span>5점</span> · 매우 적극적 / 전문성 높음</div>
                                <div class="tooltip-line"><span>4점</span> · 역량 충분 / 협업 적극적</div>
                                <div class="tooltip-line"><span>3점</span> · 기본 역량 충분 / 일반적 수행 가능</div>
                                <div class="tooltip-line"><span>2점</span> · 리소스 부족 / 일정 위험</div>
                                <div class="tooltip-line"><span>1점</span> · 리소스 없음 / 진행 불가</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>도입 지원 리소스</td>
                          <td>
                            <select data-tf-score="humanSupport">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-human-support">i
                              <div class="tooltip" id="tt-human-support">
                                <div class="tooltip-title">Human · 도입 지원 리소스</div>
                                <div class="tooltip-line"><span>5점</span> · 즉시 투입 가능 / 여유 있음</div>
                                <div class="tooltip-line"><span>4점</span> · 충분한 지원 가능</div>
                                <div class="tooltip-line"><span>3점</span> · 일반적 수준 / 일부 조율 필요</div>
                                <div class="tooltip-line"><span>2점</span> · 리소스 부족 / 일정 불확실</div>
                                <div class="tooltip-line"><span>1점</span> · 지원 리소스 거의 없음</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td>일정/범위 현실성</td>
                          <td>
                            <select data-tf-score="humanTimeline">
                              <option value="">-</option>
                              <option value="5">5</option>
                              <option value="4">4</option>
                              <option value="3">3</option>
                              <option value="2">2</option>
                              <option value="1">1</option>
                            </select>
                          </td>
                          <td>
                            <div class="info-icon" data-tooltip-id="tt-human-timeline">i
                              <div class="tooltip" id="tt-human-timeline">
                                <div class="tooltip-title">Human · 일정/범위 현실성</div>
                                <div class="tooltip-line"><span>5점</span> · 즉시 착수 가능 / 강한 추진력</div>
                                <div class="tooltip-line"><span>4점</span> · 일정 명확 / 실행력 있음</div>
                                <div class="tooltip-line"><span>3점</span> · 일정 존재 / 변동 가능성 있음</div>
                                <div class="tooltip-line"><span>2점</span> · 일정 모호 / 우선순위 낮음</div>
                                <div class="tooltip-line"><span>1점</span> · 일정 불명확 / 실현 어려움</div>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div>
                    <div class="weight-card">
                      <div class="weight-card-header">
                        <div class="weight-card-title">가중치 설정</div>
                        <span class="pill-muted">합계 = 1.00</span>
                      </div>

                      <div class="weight-row">
                        <span>Technical Fit</span>
                        <div class="weight-controls">
                          <button type="button" class="weight-btn"
                            data-target="tfWeightTechnicalFit" data-delta="-0.01">−</button>
                          <input type="number" step="0.01" class="weight-input"
                            id="tfWeightTechnicalFit" value="0.35" />
                          <button type="button" class="weight-btn"
                            data-target="tfWeightTechnicalFit" data-delta="0.01">+</button>
                        </div>
                      </div>

                      <div class="weight-row">
                        <span>Environment &amp; Integration</span>
                        <div class="weight-controls">
                          <button type="button" class="weight-btn"
                            data-target="tfWeightEnvironment" data-delta="-0.01">−</button>
                          <input type="number" step="0.01" class="weight-input"
                            id="tfWeightEnvironment" value="0.25" />
                          <button type="button" class="weight-btn"
                            data-target="tfWeightEnvironment" data-delta="0.01">+</button>
                        </div>
                      </div>

                      <div class="weight-row">
                        <span>Compliance &amp; Security</span>
                        <div class="weight-controls">
                          <button type="button" class="weight-btn"
                            data-target="tfWeightCompliance" data-delta="-0.01">−</button>
                          <input type="number" step="0.01" class="weight-input"
                            id="tfWeightCompliance" value="0.20" />
                          <button type="button" class="weight-btn"
                            data-target="tfWeightCompliance" data-delta="0.01">+</button>
                        </div>
                      </div>

                      <div class="weight-row">
                        <span>Human &amp; Execution</span>
                        <div class="weight-controls">
                          <button type="button" class="weight-btn"
                            data-target="tfWeightHuman" data-delta="-0.01">−</button>
                          <input type="number" step="0.01" class="weight-input"
                            id="tfWeightHuman" value="0.20" />
                          <button type="button" class="weight-btn"
                            data-target="tfWeightHuman" data-delta="0.01">+</button>
                        </div>
                      </div>

                      <div id="tfWeightSumText" class="weight-sum">
                        합계: 1.00
                      </div>
                      <div class="helper-text">
                        가중치의 합은 100%(1)입니다. 합계가 1을 넘거나 모자라면 결과 계산이 비활성화됩니다.
                      </div>
                    </div>
                  </div>
                </div>

                <div class="section-footer">
                  <div class="helper-text">
                    모든 적합성 항목과 가중치를 설정한 뒤, 결과 보기를 눌러 Technical Fit Score와 Risk Level을 확인하세요.
                  </div>
                  <div>
                    <button class="btn-primary" id="techFitResultButton">
                      결과 보기
                    </button>
                  </div>
                </div>

                <div id="techFitResultArea" style="display:none;">
                  <div class="result-summary">
                    <div class="result-pill">
                      <div>
                        <div class="result-label">Technical Fit Score</div>
                        <div id="techScoreValue">-</div>
                      </div>
                      <div>
                        <div class="result-label">Risk Level</div>
                        <div id="techRiskValue">-</div>
                      </div>
                    </div>
                  </div>
                  <div class="risk-card">
                    <div class="risk-card-header">
                      <div class="risk-card-title">Risk Summary</div>
                      <span class="risk-chip">합산 점수 2 이하 항목</span>
                    </div>
                    <ul class="risk-list" id="techFitRiskList"></ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard -->
          <div class="section" id="dashboardSectionWrapper" style="display:none;">
            <div class="section-card" id="dashboardSection">
              <div class="section-header">
                <div>
                  <div class="section-title">
                    <span>Dashboard</span>
                    <span class="pill-muted">Quadrant View</span>
                  </div>
                  <div class="section-subtitle">
                    Business Fit(Deal Win Score)와 Technical Fit Score를 기반으로 Deal 상태를 2×2 Quadrant로 표시합니다.
                  </div>
                </div>
              </div>
              <div class="section-body">
                <div class="metrics-row">
                  <div class="metric-card">
                    <div class="metric-label">Deal Name</div>
                    <div class="metric-value" id="dashDealName">-</div>
                    <div class="metric-sub" id="dashDealDescription"></div>
                  </div>
                  <div class="metric-card">
                    <div class="metric-label">Deal Win Score (Business Fit)</div>
                    <div class="metric-value" id="dashDealScore">-</div>
                    <div class="metric-sub" id="dashWinProb"></div>
                  </div>
                  <div class="metric-card">
                    <div class="metric-label">Technical Fit Score</div>
                    <div class="metric-value" id="dashTechScore">-</div>
                    <div class="metric-sub" id="dashTechRisk"></div>
                  </div>
                </div>

                <div class="dashboard-grid">
                  <div class="quadrant-card">
                    <div class="quadrant-header">
                      <span>Quadrant View (Business Fit vs Technical Fit)</span>
                      <span style="font-size:11px;color:#6b7280;">X축: Deal Win Score · Y축: Technical Fit Score</span>
                    </div>
                    <canvas id="quadrantCanvas"></canvas>
                  </div>
                  <div class="summary-card">
                    <div class="summary-zone" id="summaryZone">-</div>
                    <div class="summary-body" id="summaryBody">
                      Deal 결과를 계산하면 자동으로 총평이 생성됩니다.
                    </div>
                    <div class="summary-actions" id="summaryActions">
                      권장 액션이 여기에 표시됩니다.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <div class="save-banner" id="save-banner">
      ✓ 저장되었습니다
    </div>
  </div>

  <script>
    const STORAGE_KEY = "bada_deals";
    let currentDeal = null;
    let dealId = null;

    // ===== LocalStorage Helper =====
    function loadAllDeals() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("BADA storage parse error:", e);
        return {};
      }
    }

    function saveAllDeals(deals) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(deals));
    }

    // ===== Core Functions =====
    function showModal(title, body) {
      alert(`${title}\n\n${body}`);
    }

    function readWeight(id) {
      const el = document.getElementById(id);
      const v = parseFloat(el.value);
      return isNaN(v) ? 0 : v;
    }

    function setupWeightButtons() {
      const buttons = document.querySelectorAll(".weight-btn");
      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const targetId = btn.dataset.target;
          const delta = parseFloat(btn.dataset.delta || "0");
          const input = document.getElementById(targetId);
          if (!input) return;
          let val = parseFloat(input.value);
          if (isNaN(val)) val = 0;
          val += delta;
          if (val < 0) val = 0;
          if (val > 1) val = 1;
          input.value = val.toFixed(2);
          input.dispatchEvent(new Event("input", { bubbles: true }));
        });
      });
    }

    function setupWeightValidation(prefix, ids, sumTextId, buttonId) {
      const inputs = ids.map((id) => document.getElementById(id));
      const sumText = document.getElementById(sumTextId);
      const button = document.getElementById(buttonId);

      function update() {
        let sum = 0;
        inputs.forEach((el) => {
          const v = parseFloat(el.value);
          if (!isNaN(v)) sum += v;
        });
        sumText.textContent = "합계: " + sum.toFixed(2);
        if (Math.abs(sum - 1) > 0.001) {
          sumText.classList.add("error");
          if (button) button.disabled = true;
        } else {
          sumText.classList.remove("error");
          if (button) button.disabled = false;
        }
      }

      inputs.forEach((el) => el.addEventListener("input", update));
      update();
    }

    function getSelectValue(name, type) {
      const selector = type === "dw"
        ? `select[data-dw-score="${name}"]`
        : `select[data-tf-score="${name}"]`;
      const el = document.querySelector(selector);
      if (!el) return null;
      const v = parseInt(el.value, 10);
      return isNaN(v) ? null : v;
    }

    function avg(values) {
      const valid = values.filter((v) => v != null);
      if (!valid.length) return null;
      const s = valid.reduce((a, b) => a + b, 0);
      return s / valid.length;
    }

    function computeDealWinScore() {
      const budgetReadiness = getSelectValue("budgetReadiness", "dw");
      const authorityChampion = getSelectValue("authorityChampion", "dw");
      const authorityAccess = getSelectValue("authorityAccess", "dw");
      const needFit = getSelectValue("needFit", "dw");
      const needCompetition = getSelectValue("needCompetition", "dw");
      const timelineUrgency = getSelectValue("timelineUrgency", "dw");
      const timelineEase = getSelectValue("timelineEase", "dw");

      const values = [
        budgetReadiness, authorityChampion, authorityAccess,
        needFit, needCompetition, timelineUrgency, timelineEase
      ];

      if (values.some((v) => v == null)) {
        showModal("입력 오류", "모든 Deal 항목에 점수를 입력해 주세요.");
        return;
      }

      const budgetSum = budgetReadiness;
      const authoritySum = avg([authorityChampion, authorityAccess]);
      const needSum = avg([needFit, needCompetition]);
      const timelineSum = avg([timelineUrgency, timelineEase]);

      const dealScore = avg([budgetSum, authoritySum, needSum, timelineSum]);
      const dealScoreRounded = Math.max(0, Math.min(100, (dealScore / 5) * 100));

      let winProb = 10;
      let winLabel = "매우 낮음";
      if (dealScoreRounded >= 81) {
        winProb = 90; winLabel = "매우 높음";
      } else if (dealScoreRounded >= 61) {
        winProb = 70; winLabel = "높음";
      } else if (dealScoreRounded >= 41) {
        winProb = 50; winLabel = "중간";
      } else if (dealScoreRounded >= 21) {
        winProb = 30; winLabel = "낮음";
      }

      document.getElementById("dealScoreValue").textContent =
        dealScoreRounded.toFixed(1) + "%";
      document.getElementById("winProbValue").textContent =
        winProb + "% (" + winLabel + ")";

      const riskList = document.getElementById("dealWinRiskList");
      riskList.innerHTML = "";
      const risks = [];

      if (budgetSum <= 2) {
        risks.push("예산 리스크: 구매 가능성 낮음 (Budget 합산 ≤ 2)");
      }
      if (authoritySum <= 2) {
        risks.push("Authority 리스크: 챔피언/EB 영향력 및 접근성이 부족합니다.");
      }
      if (needSum <= 2) {
        risks.push("Need 리스크: 문제 적합성이 낮거나 경쟁 우위가 부족합니다.");
      }
      if (timelineSum <= 2) {
        risks.push("Timeline 리스크: 시급성이 낮거나 도입이 어렵습니다.");
      }

      if (!risks.length) {
        const li = document.createElement("li");
        li.textContent = "특별히 눈에 띄는 리스크는 없습니다. 다만 세부 항목을 정성적으로 점검해 보세요.";
        riskList.appendChild(li);
      } else {
        risks.forEach((r) => {
          const li = document.createElement("li");
          li.textContent = r;
          riskList.appendChild(li);
        });
      }

      document.getElementById("dealWinResultArea").style.display = "";

      if (!currentDeal) currentDeal = {};
      currentDeal.dealScore = dealScoreRounded;
      currentDeal.winProb = winProb;
      currentDeal.winProbLabel = winLabel;
      currentDeal.dealWinGroups = {
        budget: budgetSum,
        authority: authoritySum,
        need: needSum,
        timeline: timelineSum,
      };
      currentDeal.dealWinRiskSummary = risks;

      saveDQResults();
      updateProgress();

      showModal(
        "Win Probability",
        `Deal Score ${dealScoreRounded.toFixed(1)}% → Win Probability ${winProb}% (${winLabel})`
      );
    }

    function computeTechFitScore() {
      const tfFunctional = getSelectValue("tfFunctional", "tf");
      const tfCustomization = getSelectValue("tfCustomization", "tf");
      const tfLegacy = getSelectValue("tfLegacy", "tf");

      const envInfra = getSelectValue("envInfra", "tf");
      const envIntegration = getSelectValue("envIntegration", "tf");
      const envNetwork = getSelectValue("envNetwork", "tf");

      const compSecurity = getSelectValue("compSecurity", "tf");
      const compRegulatory = getSelectValue("compRegulatory", "tf");
      const compData = getSelectValue("compData", "tf");

      const humanTeam = getSelectValue("humanTeam", "tf");
      const humanSupport = getSelectValue("humanSupport", "tf");
      const humanTimeline = getSelectValue("humanTimeline", "tf");

      const values = [
        tfFunctional, tfCustomization, tfLegacy,
        envInfra, envIntegration, envNetwork,
        compSecurity, compRegulatory, compData,
        humanTeam, humanSupport, humanTimeline
      ];

      if (values.some((v) => v == null)) {
        showModal("입력 오류", "모든 적합성 항목에 점수를 입력해 주세요.");
        return;
      }

      const technicalFit = avg([tfFunctional, tfCustomization, tfLegacy]);
      const envIntegrationSum = avg([envInfra, envIntegration, envNetwork]);
      const complianceSum = avg([compSecurity, compRegulatory, compData]);
      const humanSum = avg([humanTeam, humanSupport, humanTimeline]);

      const wTF = readWeight("tfWeightTechnicalFit");
      const wEnv = readWeight("tfWeightEnvironment");
      const wComp = readWeight("tfWeightCompliance");
      const wHuman = readWeight("tfWeightHuman");
      const wSum = wTF + wEnv + wComp + wHuman;
      if (Math.abs(wSum - 1) > 0.001) {
        showModal("가중치 오류", "Technical Fit 가중치 합계가 1이 아닙니다. 합계를 1로 맞춘 뒤 다시 시도해 주세요.");
        return;
      }

      const raw =
        (wTF * technicalFit) +
        (wEnv * envIntegrationSum) +
        (wComp * complianceSum) +
        (wHuman * humanSum);

      const techScore = (raw / 5) * 100;
      const techScoreRounded = Math.max(0, Math.min(100, techScore));

      let riskLevel = "매우 높음";
      let riskLabel = "기술적 불가";
      if (techScoreRounded >= 81) {
        riskLevel = "매우 낮음";
        riskLabel = "매우 적합";
      } else if (techScoreRounded >= 61) {
        riskLevel = "낮음";
        riskLabel = "적합함";
      } else if (techScoreRounded >= 41) {
        riskLevel = "중간";
        riskLabel = "주의 필요";
      } else if (techScoreRounded >= 21) {
        riskLevel = "높음";
        riskLabel = "중단 고려";
      }

      document.getElementById("techScoreValue").textContent =
        techScoreRounded.toFixed(1) + "%";
      document.getElementById("techRiskValue").textContent =
        riskLevel + " (" + riskLabel + ")";

      const riskList = document.getElementById("techFitRiskList");
      riskList.innerHTML = "";
      const risks = [];

      if (technicalFit <= 2) {
        risks.push("Technical Fit 리스크: 기능 적합성/커스터마이징/레거시 제약이 큽니다.");
      }
      if (envIntegrationSum <= 2) {
        risks.push("Environment & Integration 리스크: 인프라/연동/환경 제약이 큽니다.");
      }
      if (complianceSum <= 2) {
        risks.push("Compliance & Security 리스크: 보안·규제·데이터 적합성 리스크가 높습니다.");
      }
      if (humanSum <= 2) {
        risks.push("Human & Execution 리스크: 고객 기술팀·지원 리소스·일정 현실성이 부족합니다.");
      }

      if (!risks.length) {
        const li = document.createElement("li");
        li.textContent = "특별히 눈에 띄는 기술 리스크는 없습니다. 보안·규제·환경은 별도로 다시 점검해 보세요.";
        riskList.appendChild(li);
      } else {
        risks.forEach((r) => {
          const li = document.createElement("li");
          li.textContent = r;
          riskList.appendChild(li);
        });
      }

      document.getElementById("techFitResultArea").style.display = "";

      // currentDeal 객체에 데이터 저장
      if (!currentDeal) currentDeal = {};
      currentDeal.techScore = techScoreRounded;
      currentDeal.techRisk = riskLevel;
      currentDeal.techRiskLabel = riskLabel;
      currentDeal.techWeights = { wTF, wEnv, wComp, wHuman };
      currentDeal.techGroups = {
        technicalFit,
        envIntegration: envIntegrationSum,
        compliance: complianceSum,
        human: humanSum,
      };
      currentDeal.techRiskSummary = risks;

      // Dashboard 표시 및 업데이트
      document.getElementById("dashboardSectionWrapper").style.display = "";
      updateDashboard();

      saveDQResults();
      updateProgress();

      showModal(
        "Technical Risk Level",
        `Technical Fit Score ${techScoreRounded.toFixed(1)}% → Risk Level ${riskLevel} (${riskLabel})`
      );
    }

    function drawQuadrant(bizScore, techScore) {
      const canvas = document.getElementById("quadrantCanvas");
      if (!canvas) return;
      const rect = canvas.getBoundingClientRect();
      if (!rect.width || !rect.height) return;

      const dpr = window.devicePixelRatio || 1;
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      const ctx = canvas.getContext("2d");
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      const width = rect.width;
      const height = rect.height;
      const margin = 28;
      const plotWidth = width - margin * 2;
      const plotHeight = height - margin * 2;

      ctx.clearRect(0, 0, width, height);

      ctx.fillStyle = "#f9fafb";
      ctx.fillRect(0, 0, width, height);

      const midX = margin + plotWidth / 2;
      const midY = margin + plotHeight / 2;

      ctx.fillStyle = "#E3F2FD";
      ctx.fillRect(margin, margin, plotWidth / 2, plotHeight / 2);

      ctx.fillStyle = "#E8F5E9";
      ctx.fillRect(midX, margin, plotWidth / 2, plotHeight / 2);

      ctx.fillStyle = "#FDECEA";
      ctx.fillRect(margin, midY, plotWidth / 2, plotHeight / 2);

      ctx.fillStyle = "#FFF8E1";
      ctx.fillRect(midX, midY, plotWidth / 2, plotHeight / 2);

      ctx.strokeStyle = "#9ca3af";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(margin, midY);
      ctx.lineTo(margin + plotWidth, midY);
      ctx.moveTo(midX, margin);
      ctx.lineTo(midX, margin + plotHeight);
      ctx.stroke();

      ctx.strokeStyle = "#d1d5db";
      ctx.strokeRect(margin, margin, plotWidth, plotHeight);

      ctx.fillStyle = "#4b5563";
      ctx.font = "11px system-ui";
      ctx.fillText("Business Fit (Deal Win Score)", margin, height - 6);
      ctx.save();
      ctx.translate(6, margin + plotHeight);
      ctx.rotate(-Math.PI / 2);
      ctx.fillText("Technical Fit Score", 0, 0);
      ctx.restore();

      ctx.font = "11px system-ui";

      ctx.fillStyle = "#5DADE2";
      ctx.fillText("Tech OK but Biz Weak", margin + 6, margin + 14);
      ctx.fillStyle = "#4CAF50";
      ctx.fillText("Go", midX + 6, margin + 14);
      ctx.fillStyle = "#C0392B";
      ctx.fillText("No-Go", margin + 6, midY + 14);
      ctx.fillStyle = "#F4C542";
      ctx.fillText("Biz OK but Tech Risk", midX + 6, midY + 14);

      const clampedBiz = Math.max(0, Math.min(100, bizScore || 0));
      const clampedTech = Math.max(0, Math.min(100, techScore || 0));

      const x = margin + (clampedBiz / 100) * plotWidth;
      const y = margin + plotHeight - (clampedTech / 100) * plotHeight;

      ctx.fillStyle = "#111827";
      ctx.beginPath();
      ctx.arc(x, y, 5, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "#111827";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, Math.PI * 2);
      ctx.stroke();
    }

    function updateDashboard() {
      if (!currentDeal) {
        console.log("currentDeal이 없습니다");
        return;
      }
      
      const dealScore = currentDeal.dealScore;
      const winProb = currentDeal.winProb;
      const winProbLabel = currentDeal.winProbLabel;
      const techScore = currentDeal.techScore;
      const techRisk = currentDeal.techRisk;
      const techRiskLabel = currentDeal.techRiskLabel;
      
      console.log("Dashboard 업데이트:", { dealScore, winProb, techScore, techRisk });
      
      if (dealScore == null || techScore == null) {
        console.log("점수가 없습니다:", dealScore, techScore);
        return;
      }

      const m = currentDeal.meta;
      document.getElementById("dashDealName").textContent = m.dealName || "-";
      document.getElementById("dashDealDescription").textContent = m.note || "";

      document.getElementById("dashDealScore").textContent =
        dealScore.toFixed(1) + "%";
      document.getElementById("dashWinProb").textContent =
        `Win Prob ${winProb}% (${winProbLabel})`;

      document.getElementById("dashTechScore").textContent =
        techScore.toFixed(1) + "%";
      document.getElementById("dashTechRisk").textContent =
        `Risk ${techRisk} (${techRiskLabel})`;

      let zone = "No-Go Zone";
      let zoneColor = "#C0392B";
      if (dealScore >= 50 && techScore >= 50) {
        zone = "Strong Opportunity";
        zoneColor = "#4CAF50";
      } else if (dealScore >= 50 && techScore < 50) {
        zone = "Biz OK but Tech Risk";
        zoneColor = "#F4C542";
      } else if (dealScore < 50 && techScore >= 50) {
        zone = "Tech OK but Biz Weak";
        zoneColor = "#5DADE2";
      }

      const summaryZoneEl = document.getElementById("summaryZone");
      summaryZoneEl.textContent = zone;
      summaryZoneEl.style.color = zoneColor;

      let summaryBody = "";
      let actions = "";

      if (zone === "Strong Opportunity") {
        summaryBody =
          `이 딜은 Business Fit과 Technical Fit 모두 양호합니다. Deal Win Score ${dealScore.toFixed(1)}%, `
          + `Technical Fit ${techScore.toFixed(1)}% 수준으로, 수주 가능성이 높습니다.`;
        actions =
          "권장 액션: 경재적 구매자 정렬 조기 확보, 단계 빠르게 진행, PoC 최소화 또는 생략, 경쟁사 차단을 위한 계약·보안 절차를 신속히 진행하세요.";
      } else if (zone === "Biz OK but Tech Risk") {
        summaryBody =
          `이 딜은 Business Fit은 괜찮지만 Technical Fit이 상대적으로 낮습니다. `
          + `기술 리스크를 명확히 관리하지 않으면 PoC 실패나 일정 지연으로 이어질 수 있습니다.`;
        actions =
          "권장 액션: 기술 리스크를 솔직하게 공유하고, 대안 아키텍처·로드맵을 제시하세요. PoC 범위와 성공 기준을 명확히 정의하고 IT/Sec를 조기에 참여시켜 리스크를 줄이세요.";
      } else if (zone === "Tech OK but Biz Weak") {
        summaryBody =
          `이 딜은 기술적으로는 충분히 적합하지만 Business Fit(예산·권한·Need·타이밍)이 약한 상태입니다. `
          + `기술 설득만으로는 수주까지 가기 어렵습니다.`;
        actions =
          "권장 액션: 챔피언 및 경제적 구매자 관여도를 높이고, 구매 동기와 비즈니스 임팩트를 재정의하세요. 상위 과제와 연결된 Value Narrative를 강화하고, 경쟁 구도와 타이밍 리스크를 다시 진단하세요.";
      } else {
        summaryBody =
          `Business Fit과 Technical Fit 모두 낮은 편입니다. 현재 상태로는 수주 가능성이 낮으며, `
          + `무리한 추적은 팀 리소스 대비 효율이 떨어질 수 있습니다.`;
        actions =
          "권장 액션: 이 딜을 계속 추적할 가치가 있는지 재평가하세요. 필수 기준(예산, 스폰서, 기술 제약 등)을 명확히 점검하고, 조건부로 유지하거나 과감히 No-Go를 선택하는 것도 고려해 보세요.";
      }

      document.getElementById("summaryBody").textContent = summaryBody;
      document.getElementById("summaryActions").textContent = actions;

      if (!currentDeal.dashboardSummary) {
        currentDeal.dashboardSummary = { zone, summaryBody, actions };
      }

      drawQuadrant(dealScore, techScore);
    }

    function saveDQResults() {
      if (!currentDeal || currentDeal.dealScore == null || currentDeal.techScore == null) return;

      const deals = loadAllDeals();
      if (!deals[dealId]) return;

      deals[dealId].dq = {
        dealScore: currentDeal.dealScore,
        winProb: currentDeal.winProb,
        winProbLabel: currentDeal.winProbLabel,
        techScore: currentDeal.techScore,
        techRisk: currentDeal.techRisk,
        techRiskLabel: currentDeal.techRiskLabel,
        dealWinWeights: currentDeal.dealWinWeights,
        techWeights: currentDeal.techWeights,
        dealWinGroups: currentDeal.dealWinGroups,
        techGroups: currentDeal.techGroups,
        dealWinRiskSummary: currentDeal.dealWinRiskSummary,
        techRiskSummary: currentDeal.techRiskSummary,
        dashboardSummary: currentDeal.dashboardSummary
      };

      deals[dealId].meta.updatedAt = new Date().toISOString();

      saveAllDeals(deals);
      showSaveBanner();
    }

    function showSaveBanner() {
      const banner = document.getElementById("save-banner");
      banner.classList.add("show");
      setTimeout(() => {
        banner.classList.remove("show");
      }, 2000);
    }

    function updateProgress() {
      const totalFields = 19;
      let filledFields = 0;

      const dwFields = [
        "budgetReadiness", "authorityChampion", "authorityAccess", 
        "needFit", "needCompetition", "timelineUrgency", "timelineEase"
      ];
      dwFields.forEach(field => {
        if (getSelectValue(field, "dw") !== null) filledFields++;
      });

      const tfFields = [
        "tfFunctional", "tfCustomization", "tfLegacy",
        "envInfra", "envIntegration", "envNetwork",
        "compSecurity", "compRegulatory", "compData",
        "humanTeam", "humanSupport", "humanTimeline"
      ];
      tfFields.forEach(field => {
        if (getSelectValue(field, "tf") !== null) filledFields++;
      });

      const percentage = Math.round((filledFields / totalFields) * 100);
      document.getElementById("progress-fill").style.width = `${percentage}%`;
    }

    function renderDealInfo() {
      const dealInfoEl = document.getElementById("deal-info");
      const m = currentDeal.meta;

      const items = [
        { label: "Deal 이름", value: m.dealName },
        { label: "고객사", value: m.customerName },
        { label: "고객 담당자", value: m.buyerPersona },
        { label: "솔루션", value: m.solutionName },
        { label: "현재 단계", value: m.stage },
        { label: "자사 담당자", value: m.ownerName },
      ];

      dealInfoEl.innerHTML = items
        .map(
          (item) => `
          <div class="deal-info-item">
            <div class="deal-info-label">${item.label}</div>
            <div class="deal-info-value">${item.value || "(입력 없음)"}</div>
          </div>
        `
        )
        .join("");
    }

    function loadExistingDQData() {
  if (!currentDeal.dq) return;

  const dq = currentDeal.dq;

  // Deal Win Score 드롭다운 값 설정
  if (dq.dealWinGroups) {
    // Budget
    if (dq.dealWinGroups.budget !== undefined) {
      setSelectValue("budgetReadiness", "dw", dq.dealWinGroups.budget);
    }
    
    // Authority
    if (dq.dealWinGroups.authorityChampion !== undefined) {
      setSelectValue("authorityChampion", "dw", dq.dealWinGroups.authorityChampion);
    }
    if (dq.dealWinGroups.authorityAccess !== undefined) {
      setSelectValue("authorityAccess", "dw", dq.dealWinGroups.authorityAccess);
    }
    
    // Need
    if (dq.dealWinGroups.needFit !== undefined) {
      setSelectValue("needFit", "dw", dq.dealWinGroups.needFit);
    }
    if (dq.dealWinGroups.needCompetition !== undefined) {
      setSelectValue("needCompetition", "dw", dq.dealWinGroups.needCompetition);
    }
    
    // Timeline
    if (dq.dealWinGroups.timelineUrgency !== undefined) {
      setSelectValue("timelineUrgency", "dw", dq.deelWinGroups.timelineUrgency);
    }
    if (dq.dealWinGroups.timelineEase !== undefined) {
      setSelectValue("timelineEase", "dw", dq.dealWinGroups.timelineEase);
    }

    if (dq.dealScore) {
      document.getElementById("dealScoreValue").textContent = dq.dealScore.toFixed(1) + "%";
      document.getElementById("winProbValue").textContent = dq.winProb + "% (" + dq.winProbLabel + ")";
      document.getElementById("dealWinResultArea").style.display = "";
    }

    if (dq.dealWinRiskSummary) {
      const riskList = document.getElementById("dealWinRiskList");
      riskList.innerHTML = "";
      dq.dealWinRiskSummary.forEach(risk => {
        const li = document.createElement("li");
        li.textContent = risk;
        riskList.appendChild(li);
      });
    }
  }

  // Technical Fit Score 드롭다운 값 설정
  if (dq.techGroups) {
    // Technical Fit
    if (dq.techGroups.tfFunctional !== undefined) {
      setSelectValue("tfFunctional", "tf", dq.techGroups.tfFunctional);
    }
    if (dq.techGroups.tfCustomization !== undefined) {
      setSelectValue("tfCustomization", "tf", dq.techGroups.tfCustomization);
    }
    if (dq.techGroups.tfLegacy !== undefined) {
      setSelectValue("tfLegacy", "tf", dq.techGroups.tfLegacy);
    }
    
    // Environment & Integration
    if (dq.techGroups.envInfra !== undefined) {
      setSelectValue("envInfra", "tf", dq.techGroups.envInfra);
    }
    if (dq.techGroups.envIntegration !== undefined) {
      setSelectValue("envIntegration", "tf", dq.techGroups.envIntegration);
    }
    if (dq.techGroups.envNetwork !== undefined) {
      setSelectValue("envNetwork", "tf", dq.techGroups.envNetwork);
    }
    
    // Compliance & Security
    if (dq.techGroups.compSecurity !== undefined) {
      setSelectValue("compSecurity", "tf", dq.techGroups.compSecurity);
    }
    if (dq.techGroups.compRegulatory !== undefined) {
      setSelectValue("compRegulatory", "tf", dq.techGroups.compRegulatory);
    }
    if (dq.techGroups.compData !== undefined) {
      setSelectValue("compData", "tf", dq.techGroups.compData);
    }
    
    // Human & Execution
    if (dq.techGroups.humanTeam !== undefined) {
      setSelectValue("humanTeam", "tf", dq.techGroups.humanTeam);
    }
    if (dq.techGroups.humanSupport !== undefined) {
      setSelectValue("humanSupport", "tf", dq.techGroups.humanSupport);
    }
    if (dq.techGroups.humanTimeline !== undefined) {
      setSelectValue("humanTimeline", "tf", dq.techGroups.humanTimeline);
    }

    // 가중치 설정
    if (dq.techWeights) {
      if (dq.techWeights.wTF !== undefined) {
        document.getElementById("tfWeightTechnicalFit").value = dq.techWeights.wTF.toFixed(2);
      }
      if (dq.techWeights.wEnv !== undefined) {
        document.getElementById("tfWeightEnvironment").value = dq.techWeights.wEnv.toFixed(2);
      }
      if (dq.techWeights.wComp !== undefined) {
        document.getElementById("tfWeightCompliance").value = dq.techWeights.wComp.toFixed(2);
      }
      if (dq.techWeights.wHuman !== undefined) {
        document.getElementById("tfWeightHuman").value = dq.techWeights.wHuman.toFixed(2);
      }
      
      // 가중치 합계 업데이트 트리거
      document.getElementById("tfWeightTechnicalFit").dispatchEvent(new Event("input", { bubbles: true }));
    }

    if (dq.techScore) {
      document.getElementById("techScoreValue").textContent = dq.techScore.toFixed(1) + "%";
      document.getElementById("techRiskValue").textContent = dq.techRisk + " (" + dq.techRiskLabel + ")";
      document.getElementById("techFitResultArea").style.display = "";
    }

    if (dq.techRiskSummary) {
      const riskList = document.getElementById("techFitRiskList");
      riskList.innerHTML = "";
      dq.techRiskSummary.forEach(risk => {
        const li = document.createElement("li");
        li.textContent = risk;
        riskList.appendChild(li);
      });
    }
  }

  if (dq.dealScore && dq.techScore) {
    document.getElementById("dashboardSectionWrapper").style.display = "";
    updateDashboard();
  }
}

// 드롭다운 메뉴에 값을 설정하는 헬퍼 함수 추가
function setSelectValue(name, type, value) {
  const selector = type === "dw"
    ? `select[data-dw-score="${name}"]`
    : `select[data-tf-score="${name}"]`;
  const el = document.querySelector(selector);
  if (el && value !== null && value !== undefined) {
    el.value = value.toString();
  }
}

      if (dq.techGroups) {
        if (dq.techScore) {
          document.getElementById("techScoreValue").textContent = dq.techScore.toFixed(1) + "%";
          document.getElementById("techRiskValue").textContent = dq.techRisk + " (" + dq.techRiskLabel + ")";
          document.getElementById("techFitResultArea").style.display = "";
        }

        if (dq.techRiskSummary) {
          const riskList = document.getElementById("techFitRiskList");
          riskList.innerHTML = "";
          dq.techRiskSummary.forEach(risk => {
            const li = document.createElement("li");
            li.textContent = risk;
            riskList.appendChild(li);
          });
        }
      }

      if (dq.dealScore && dq.techScore) {
        document.getElementById("dashboardSectionWrapper").style.display = "";
        updateDashboard();
      }
    }

    function setupEventListeners() {
      document.getElementById("dealWinResultButton").addEventListener("click", computeDealWinScore);

      document.getElementById("techFitResultButton").addEventListener("click", () => {
        if (!currentDeal || currentDeal.dealScore == null) {
          showModal("순서 안내", "먼저 Deal Win Score를 계산한 뒤 Technical Fit Score를 계산해 주세요.");
          return;
        }
        computeTechFitScore();
      });

      document.querySelectorAll(".info-icon").forEach((icon) => {
        const ttId = icon.dataset.tooltipId;
        const tooltip = document.getElementById(ttId);
        if (!tooltip) return;
        icon.addEventListener("mouseenter", () => {
          tooltip.classList.add("visible");
        });
        icon.addEventListener("mouseleave", () => {
          tooltip.classList.remove("visible");
        });
      });

      document.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', () => {
          updateProgress();
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      dealId = new URLSearchParams(window.location.search).get("dealId");
      
      if (!dealId) {
        alert("Deal ID가 없습니다. 메인 페이지로 이동합니다.");
        window.location.href = "index.html";
        return;
      }

      const deals = loadAllDeals();
      currentDeal = deals[dealId];

      if (!currentDeal) {
        alert("Deal 정보를 찾을 수 없습니다.");
        window.location.href = "index.html";
        return;
      }

      if (!currentDeal.dq) {
        currentDeal.dq = {};
      }

      renderDealInfo();
      loadExistingDQData();
      setupEventListeners();
      setupWeightButtons();
      setupWeightValidation(
        "tf",
        ["tfWeightTechnicalFit", "tfWeightEnvironment", "tfWeightCompliance", "tfWeightHuman"],
        "tfWeightSumText",
        "techFitResultButton"
      );
      updateProgress();
    });
  </script>
</body>
</html>
