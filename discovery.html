<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BADA ‚Äì Discovery (BSA Framework)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      margin: 0;
      background-color: #f5f5f7;
      color: #111827;
    }
    header {
      background-color: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo {
      background-color: #2563eb;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    .logo-text span:first-child {
      font-weight: 600;
    }
    .logo-text span:last-child {
      font-size: 12px;
      color: #6b7280;
    }
    .btn-secondary {
      background-color: white;
      border: 1px solid #d1d5db;
      color: #111827;
      padding: 6px 12px;
      border-radius: 9999px;
      cursor: pointer;
    }
    .main {
      max-width: 960px;
      margin: 32px auto;
      padding: 0 16px;
    }
    .stage-box {
      background-color: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
      padding: 20px;
      margin-bottom: 24px;
    }
    .stage-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #2563eb;
    }
    .grid-2x2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    textarea {
      width: 100%;
      height: 60px;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      resize: vertical;
    }
    .btn-ai {
      background-color: #10b981;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 9999px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 13px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <div class="logo">B</div>
      <div class="logo-text">
        <span>BADA Discovery</span>
        <span>BSA ÌîÑÎ†àÏûÑÏõåÌÅ¨ ÏûÖÎ†•</span>
      </div>
    </div>
    <div>
      <span id="dealNamePill">Loading...</span>
      <button class="btn-secondary" onclick="goBack()">‚Üê Î™©Î°ùÏúºÎ°ú</button>
    </div>
  </header>
  <main class="main">
    <div id="stages"></div>
  </main>
  <footer>&copy; 2025 BADA Framework ¬∑ Powered by PreSales Lab</footer>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const dealId = urlParams.get("dealId");
    let dealData = {};

    function goBack() {
      window.location.href = "index.html";
    }

    function loadDeal() {
      const stored = localStorage.getItem("bada_deals");
      if (!stored) return;
      let dealList = JSON.parse(stored);
      if (!Array.isArray(dealList)) return;
      const found = dealList.find((d) => d.id === dealId);
      if (!found) return;
      dealData = found;
      document.getElementById("dealNamePill").innerText = found.name;
    }

    const journeyStages = ["Awareness", "Consideration", "Evaluation", "Purchase", "Onboarding", "Adoption & Retention", "Expansion", "Renewal"];

    function renderStages() {
      const container = document.getElementById("stages");
      journeyStages.forEach(stage => {
        const box = document.createElement("div");
        box.className = "stage-box";
        box.innerHTML = `
          <div class="stage-name">${stage}</div>
          <div class="grid-2x2">
            <textarea id="${stage}-behavior" placeholder="Í≥†Í∞ù ÌñâÎèô"></textarea>
            <textarea id="${stage}-emotion" placeholder="Í≥†Í∞ù Í∞êÏ†ï"></textarea>
            <textarea id="${stage}-channel" placeholder="Ï†ïÎ≥¥ Ï±ÑÎÑê"></textarea>
            <textarea id="${stage}-pain" placeholder="Î¨∏Ï†úÏ†ê"></textarea>
          </div>
          <button class="btn-ai" onclick="generateJTBDAndToDo('${stage}')">üí° Insight ÏÉùÏÑ±</button>
          <textarea id="${stage}-jtbd" placeholder="JTBD"></textarea>
          <textarea id="${stage}-todo" placeholder="Seller To-Do"></textarea>
        `;
        container.appendChild(box);
      });
    }

    async function callGeminiViaGAS(prompt) {
      const gasUrl = 'YOUR_GAS_DEPLOYMENT_URL';
      const response = await fetch(gasUrl, {
        method: 'POST',
        body: JSON.stringify({ prompt }),
        headers: {
          'Content-Type': 'application/json'
        }
      });
      const result = await response.json();
      return result.candidates?.[0]?.content?.parts?.[0]?.text || "Í≤∞Í≥º ÏóÜÏùå";
    }

    function buildPrompt(stage) {
      const behavior = document.getElementById(`${stage}-behavior`).value;
      const emotion = document.getElementById(`${stage}-emotion`).value;
      const channel = document.getElementById(`${stage}-channel`).value;
      const pain = document.getElementById(`${stage}-pain`).value;
      return `
ÎãπÏã†ÏùÄ B2B Í≥†Í∞ù Ïó¨Ï†ï Ï†ÑÎûµÍ∞ÄÏûÖÎãàÎã§. ÏïÑÎûò Í≥†Í∞ù Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í≥†Í∞ùÏùò JTBDÏôÄ ÌîÑÎ¶¨ÏÑ∏ÏùºÏ¶à Îã¥ÎãπÏûêÏùò To-DoÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî.

[Í≥†Í∞ù Ïó¨Ï†ï Îã®Í≥Ñ] ${stage}
[Í≥†Í∞ù ÌñâÎèô] ${behavior}
[Í∞êÏ†ï] ${emotion}
[Ï†ïÎ≥¥ Ï±ÑÎÑê] ${channel}
[Î¨∏Ï†úÏ†ê] ${pain}

Í≤∞Í≥ºÎäî Îã§ÏùåÍ≥º Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî:

Í≥†Í∞ùÏùò JTBDÎäî ~Ïù¥Îã§.
Seller To-Do:
- ~
- ~
      `;
    }

    async function generateJTBDAndToDo(stage) {
      const prompt = buildPrompt(stage);
      const result = await callGeminiViaGAS(prompt);
      const [jtbdLine, ...todoLines] = result.split("\n").filter(line => line.trim() !== "");
      document.getElementById(`${stage}-jtbd`).value = jtbdLine || "";
      document.getElementById(`${stage}-todo`).value = todoLines.join("\n");
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadDeal();
      renderStages();
    });
  </script>
</body>
</html>
