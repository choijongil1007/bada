<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BADA ‚Äì Discovery (BSA Framework)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-body: #f5f5f7;
      --bg-surface: #ffffff;
      --bg-subtle: #f9fafb;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --text-main: #111827;
      --text-muted: #6b7280;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.08);
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.04);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e0ecff, #f5f5f7);
      color: var(--text-main);
    }
    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(12px);
      background: rgba(245, 245, 247, 0.9);
      border-bottom: 1px solid rgba(209, 213, 219, 0.6);
    }
    .header-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .logo-area {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-badge {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
    }
    .logo-text-main {
      font-weight: 700;
      font-size: 18px;
    }
    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
      color: var(--text-muted);
      background: rgba(255, 255, 255, 0.7);
    }
    .btn {
      border: 0;
      border-radius: 999px;
      font-size: 13px;
      padding: 6px 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: #111827;
      color: #f9fafb;
    }
    .btn.secondary {
      background: #ffffff;
      color: #111827;
      border: 1px solid var(--border-subtle);
    }
    .btn.ai {
      background: #10b981;
      color: white;
    }
    .btn span.icon {
      font-size: 14px;
    }
    main {
      flex: 1;
    }
    .main-inner {
      max-width: 1120px;
      margin: 12px auto 40px;
      padding: 0 16px 24px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 2.2fr);
      gap: 18px;
    }
    @media (max-width: 960px) {
      .main-inner {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .section-title {
      font-weight: 600;
      font-size: 18px;
      margin: 20px 0 10px;
    }
    textarea, input {
      width: 100%;
      font-size: 14px;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      background: #fff;
      color: var(--text-main);
    }
    .stage-box {
      margin-bottom: 30px;
      background: var(--bg-subtle);
      padding: 16px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
    }
    .stage-name {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 16px;
      color: #2563eb;
    }
    .ai-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .ai-buttons button {
      flex: 1;
    }
    footer {
      padding: 20px;
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="header-inner">
        <div class="logo-area">
          <div class="logo-badge">B</div>
          <div class="logo-text">
            <div class="logo-text-main">BADA Discovery</div>
            <div class="logo-text-sub">BSA ÌîÑÎ†àÏûÑÏõåÌÅ¨ ÏûÖÎ†•</div>
          </div>
        </div>
        <div class="header-right">
          <div id="dealNamePill" class="pill">Loading Deal...</div>
          <button class="btn secondary" onclick="goBack()">‚Üê Î™©Î°ùÏúºÎ°ú</button>
        </div>
      </div>
    </header>
    <main>
      <div class="main-inner">
        <div>
          <div class="section-title">Í≥†Í∞ù Ïó¨Ï†ï Îã®Í≥ÑÎ≥Ñ ÏûÖÎ†•</div>
          <div id="stages"></div>
        </div>
      </div>
    </main>
    <footer>
      &copy; 2025 BADA Framework ¬∑ Powered by PreSales Lab
    </footer>
  </div>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const dealId = urlParams.get("dealId");
    let dealData = {};
    let dealList = [];

    function goBack() {
      window.location.href = "index.html";
    }

    function loadDeal() {
      const stored = localStorage.getItem("bada_deals_v1");
      if (!stored) return;
      dealList = JSON.parse(stored);
      const found = dealList.find((d) => d.id === dealId);
      if (!found) return;
      dealData = found;
      document.getElementById("dealNamePill").innerText = found.name;
    }

    const journeyStages = [
      "Awareness", "Consideration", "Evaluation", "Purchase",
      "Onboarding", "Adoption & Retention", "Expansion", "Renewal"
    ];

    function renderStages() {
      const container = document.getElementById("stages");
      journeyStages.forEach((stage) => {
        const box = document.createElement("div");
        box.className = "stage-box";
        box.innerHTML = `
          <div class="stage-name">${stage}</div>
          <textarea placeholder="Í≥†Í∞ù ÌñâÎèô" id="${stage}-behavior"></textarea>
          <textarea placeholder="Í≥†Í∞ù Í∞êÏ†ï" id="${stage}-emotion"></textarea>
          <textarea placeholder="Ï†ïÎ≥¥ Ï±ÑÎÑê" id="${stage}-channel"></textarea>
          <textarea placeholder="Î¨∏Ï†úÏ†ê" id="${stage}-pain"></textarea>
          <div class="ai-buttons">
            <button class="btn ai" onclick="generateJTBDAndToDo('${stage}')">üí° Insight ÏÉùÏÑ±</button>
          </div>
          <textarea placeholder="JTBD" id="${stage}-jtbd"></textarea>
          <textarea placeholder="Seller To-Do" id="${stage}-todo"></textarea>
        `;
        container.appendChild(box);
      });
    }

    async function callGeminiViaGAS(prompt) {
  const gasUrl = 'https://script.google.com/macros/s/AKfycbz5eg5E4664lvp6OL2qS-vUx7CoxpyPpuov3eRMxArZCFmTrhkPMQQGql-TyEX1fZJBeg/exec'; // Î≥µÏÇ¨Ìïú URLÎ°ú ÍµêÏ≤¥

  const response = await fetch(gasUrl, {
    method: 'POST',
    body: JSON.stringify({ prompt }),
    headers: {
      'Content-Type': 'application/json'
    }
  });

  const result = await response.json();
  const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Í≤∞Í≥º ÏóÜÏùå";
  return text;
}

    function buildPrompt(stage) {
      const behavior = document.getElementById(`${stage}-behavior`).value;
      const emotion = document.getElementById(`${stage}-emotion`).value;
      const channel = document.getElementById(`${stage}-channel`).value;
      const pain = document.getElementById(`${stage}-pain`).value;
      return `
ÎãπÏã†ÏùÄ B2B Í≥†Í∞ù Ïó¨Ï†ï Ï†ÑÎûµÍ∞ÄÏûÖÎãàÎã§. ÏïÑÎûò Í≥†Í∞ù Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í≥†Í∞ùÏùò JTBDÏôÄ ÌîÑÎ¶¨ÏÑ∏ÏùºÏ¶à Îã¥ÎãπÏûêÏùò To-DoÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî.

[Í≥†Í∞ù Ïó¨Ï†ï Îã®Í≥Ñ] ${stage}
[Í≥†Í∞ù ÌñâÎèô] ${behavior}
[Í∞êÏ†ï] ${emotion}
[Ï†ïÎ≥¥ Ï±ÑÎÑê] ${channel}
[Î¨∏Ï†úÏ†ê] ${pain}

Í≤∞Í≥ºÎäî Îã§ÏùåÍ≥º Í∞ôÏùÄ ÌòïÏãùÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî:

Í≥†Í∞ùÏùò JTBDÎäî ~Ïù¥Îã§.
Seller To-Do:
- ~
- ~
`;
    }

    async function generateJTBDAndToDo(stage) {
      const prompt = buildPrompt(stage);
      const result = await callGemini(prompt);
      const [jtbdLine, ...todoLines] = result.split("\n").filter(line => line.trim() !== "");
      document.getElementById(`${stage}-jtbd`).value = jtbdLine || "";
      document.getElementById(`${stage}-todo`).value = todoLines.join("\n");
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadDeal();
      renderStages();
    });
  </script>
</body>
</html>
